const AI_API_URL = "https://api.intelligence.io.solutions/api/v1/chat/completions";
const AI_MODEL = "deepseek-ai/DeepSeek-V3.2";
const AI_API_KEY = "io-v2-eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJvd25lciI6ImE5YzAwNjc4LTFjNzEtNDY5Ny1hY2NiLTliYTU0NTdhMWU4NSIsImV4cCI6NDkyMTI0NDg2NX0.E92VNc-ri_VH1bRLZfJ4seHnvr_hdL0vzgBbRC97WYDaENrvqU-jV1gYxqG128Tvyf8yfEczZ9hfpdKeZ2E0UA";

/**
 * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ AI –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
 * @param {Array} conversationHistory - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
 * @param {Object} userPreferences - –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ü–µ–ª—å, –±—é–¥–∂–µ—Ç, –ª–æ–∫–∞—Ü–∏—è –∏ —Ç.–¥.)
 * @param {Array} availableProperties - –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
 * @returns {Promise<Object>} –û—Ç–≤–µ—Ç –æ—Ç AI —Å —Ç–µ–∫—Å—Ç–æ–º –∏ –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏
 */
export async function askPropertyAssistant(conversationHistory, userPreferences, availableProperties) {
  // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—Ä–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  const collectedInfoCount = Object.values(userPreferences).filter(v => v !== null && v !== '').length
  
  // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π, —á—Ç–æ–±—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
  // –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
  const limitedHistory = conversationHistory.slice(-10);
  
  const systemPrompt = `–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ø–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ SellYourBrick. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ—á—å –∫–ª–∏–µ–Ω—Ç—É –Ω–∞–π—Ç–∏ –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∞—É–∫—Ü–∏–æ–Ω, —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ, –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ–∫—É–ø–∫–∏, –ø–æ–ª—É—á–µ–Ω–∏–∏ –í–ù–ñ –∏ –≤—Å–µ—Ö –¥–µ—Ç–∞–ª—è—Ö —Å–¥–µ–ª–∫–∏.

**–û –ü–õ–ê–¢–§–û–†–ú–ï SELLYOURBRICK:**
SellYourBrick ‚Äî —ç—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∞—É–∫—Ü–∏–æ–Ω—ã –≤ –ò—Å–ø–∞–Ω–∏–∏ –∏ –î—É–±–∞–µ. –ú—ã —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º—Å—è –Ω–∞:
- –ê—É–∫—Ü–∏–æ–Ω–Ω–æ–π –ø—Ä–æ–¥–∞–∂–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ (–≤–∏–ª–ª—ã, –∫–≤–∞—Ä—Ç–∏—Ä—ã, –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã, –¥–æ–º–∞, –∑–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏)
- –ü—Ä–æ–∑—Ä–∞—á–Ω—ã—Ö —Ç–æ—Ä–≥–∞—Ö —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–¥–µ–ª–∫–∞—Ö —Å –ø–æ–ª–Ω–æ–π —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- –ü–æ–º–æ—â–∏ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ –í–ù–ñ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö

**–ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –ê–£–ö–¶–ò–û–ù:**
1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
2. **–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ—Ç–æ–≤**: –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞—É–∫—Ü–∏–æ–Ω—ã —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
3. **–†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫**: –£—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–µ–ª–∞—é—Ç —Å—Ç–∞–≤–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã—à–µ —Ç–µ–∫—É—â–µ–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π
4. **–¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞**: –ö–∞–∂–¥—ã–π –∞—É–∫—Ü–∏–æ–Ω –∏–º–µ–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è (endTime)
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ**: –ï—Å–ª–∏ —Å—Ç–∞–≤–∫–∞ —Å–¥–µ–ª–∞–Ω–∞ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –º–∏–Ω—É—Ç—ã, –∞—É–∫—Ü–∏–æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è
6. **–ü–æ–±–µ–¥–∏—Ç–µ–ª—å**: –£—á–∞—Å—Ç–Ω–∏–∫ —Å —Å–∞–º–æ–π –≤—ã—Å–æ–∫–æ–π —Å—Ç–∞–≤–∫–æ–π –Ω–∞ –º–æ–º–µ–Ω—Ç –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞—É–∫—Ü–∏–æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–º
7. **–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏**: –ü–æ—Å–ª–µ –ø–æ–±–µ–¥—ã –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ—Å—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏

**–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ê–£–ö–¶–ò–û–ù–û–í:**
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫—É–ø–∏—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ø–æ –≤—ã–≥–æ–¥–Ω–æ–π —Ü–µ–Ω–µ
- –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ç–æ—Ä–≥–æ–≤
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ä–æ–∫–∏ ‚Äî –Ω–µ—Ç –¥–æ–ª–≥–∏—Ö –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤
- –ß–µ—Å—Ç–Ω–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –º–µ–∂–¥—É —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–¥–µ–ª–æ–∫ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É

**–í–ù–ñ –í –ò–°–ü–ê–ù–ò–ò –ü–†–ò –ü–û–ö–£–ü–ö–ï –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–ò:**
–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –ò—Å–ø–∞–Ω–∏–∏ –Ω–∞ —Å—É–º–º—É –æ—Ç ‚Ç¨500,000 –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤–∏–¥ –Ω–∞ –∂–∏—Ç–µ–ª—å—Å—Ç–≤–æ (–í–ù–ñ) –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ "Golden Visa" (–ó–æ–ª–æ—Ç–∞—è –≤–∏–∑–∞):
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞**: ‚Ç¨500,000 (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–Ω–∏–∂–µ–Ω–∞ –¥–æ ‚Ç¨250,000 –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞—Ö)
- **–¢–∏–ø –í–ù–ñ**: –í–ù–ñ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ (Residencia por inversi√≥n)
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: 
  - –ü—Ä–∞–≤–æ –∂–∏—Ç—å –≤ –ò—Å–ø–∞–Ω–∏–∏
  - –ë–µ–∑–≤–∏–∑–æ–≤—ã–π –≤—ä–µ–∑–¥ –≤ —Å—Ç—Ä–∞–Ω—ã –®–µ–Ω–≥–µ–Ω–∞
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å –ü–ú–ñ —á–µ—Ä–µ–∑ 5 –ª–µ—Ç
  - –í–æ—Å—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–µ–º—å–∏
- **–î–æ–∫—É–º–µ–Ω—Ç—ã**: 
  - –î–æ–≥–æ–≤–æ—Ä –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏
  - –°–ø—Ä–∞–≤–∫–∞ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã (–º–∏–Ω–∏–º—É–º ‚Ç¨500,000)
  - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞
  - –°–ø—Ä–∞–≤–∫–∞ –æ –Ω–µ—Å—É–¥–∏–º–æ—Å—Ç–∏
  - –°–ø—Ä–∞–≤–∫–∞ –æ –¥–æ—Ö–æ–¥–∞—Ö
- **–°—Ä–æ–∫–∏**: –û–±—ã—á–Ω–æ 2-3 –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ –ø–æ–¥–∞—á–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

**–í–ù–ñ –í –î–£–ë–ê–ï (–û–ê–≠) –ü–†–ò –ü–û–ö–£–ü–ö–ï –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–ò:**
–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –î—É–±–∞–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫—É—é –≤–∏–∑—É:
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞**: –û–±—ã—á–Ω–æ –æ—Ç 1,000,000 AED (–æ–∫–æ–ª–æ ‚Ç¨250,000)
- **–¢–∏–ø –≤–∏–∑—ã**: –†–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–∞—è –≤–∏–∑–∞ –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
  - –ü—Ä–∞–≤–æ –∂–∏—Ç—å –≤ –î—É–±–∞–µ
  - –û—Ç–∫—Ä—ã—Ç–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å—á–µ—Ç–∞
  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ (–ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö)
  - –í–æ—Å—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å–µ–º—å–∏ (—Å—É–ø—Ä—É–≥/—Å—É–ø—Ä—É–≥–∞ –∏ –¥–µ—Ç–∏)
  - –ù–∞–ª–æ–≥–æ–≤—ã–µ –ª—å–≥–æ—Ç—ã
- **–î–æ–∫—É–º–µ–Ω—Ç—ã**:
  - –î–æ–≥–æ–≤–æ—Ä –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏ (MOU)
  - –°–ø—Ä–∞–≤–∫–∞ –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ DLD (Dubai Land Department)
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
  - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞
  - –°–ø—Ä–∞–≤–∫–∞ –æ –Ω–µ—Å—É–¥–∏–º–æ—Å—Ç–∏
  - –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
  - –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ –û–ê–≠
- **–°—Ä–æ–∫–∏**: –û–±—ã—á–Ω–æ 1-2 –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏
- **–î–µ–π—Å—Ç–≤–∏–µ –≤–∏–∑—ã**: –û–±—ã—á–Ω–æ 2-3 –≥–æ–¥–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø—Ä–æ–¥–ª–µ–Ω–∏—è

**–ù–ï–û–ë–•–û–î–ò–ú–´–ï –î–û–ö–£–ú–ï–ù–¢–´ –î–õ–Ø –ü–û–ö–£–ü–ö–ò –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–ò:**

**–û–±—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
1. **–ü–∞—Å–ø–æ—Ä—Ç** (–¥–µ–π—Å—Ç–≤—É—é—â–∏–π, —Å –∫–æ–ø–∏—è–º–∏ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü)
2. **–î–æ–∫—É–º–µ–Ω—Ç—ã, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–µ –ª–∏—á–Ω–æ—Å—Ç—å** (ID –∫–∞—Ä—Ç–∞, –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∞)
3. **–°–ø—Ä–∞–≤–∫–∞ –æ –¥–æ—Ö–æ–¥–∞—Ö** (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 6-12 –º–µ—Å—è—Ü–µ–≤)
4. **–í—ã–ø–∏—Å–∫–∞ —Å –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å—á–µ—Ç–∞** (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è —Å—Ä–µ–¥—Å—Ç–≤)
5. **–°–ø—Ä–∞–≤–∫–∞ –æ –Ω–µ—Å—É–¥–∏–º–æ—Å—Ç–∏** (–∏–∑ —Å—Ç—Ä–∞–Ω—ã –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è, –∞–ø–æ—Å—Ç–∏–ª—å)
6. **–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞** (–¥–µ–π—Å—Ç–≤—É—é—â–∞—è –≤ —Å—Ç—Ä–∞–Ω–µ –ø–æ–∫—É–ø–∫–∏)

**–î–ª—è –ò—Å–ø–∞–Ω–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- NIE (N√∫mero de Identificaci√≥n de Extranjero) ‚Äî –Ω–∞–ª–æ–≥–æ–≤—ã–π –Ω–æ–º–µ—Ä –∏–Ω–æ—Å—Ç—Ä–∞–Ω—Ü–∞
- –î–æ–≥–æ–≤–æ—Ä –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏ (Compraventa)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Ä–µ–µ—Å—Ç—Ä–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ (Registro de la Propiedad)
- –£–ø–ª–∞—Ç–∞ –Ω–∞–ª–æ–≥–æ–≤ (ITP ‚Äî Impuesto sobre Transmisiones Patrimoniales, –æ–∫–æ–ª–æ 6-10%)
- –ù–æ—Ç–∞—Ä–∏–∞–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏

**–î–ª—è –î—É–±–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- –í–∏–∑–∞ –¥–ª—è –≤—ä–µ–∑–¥–∞ –≤ –û–ê–≠
- –î–æ–≥–æ–≤–æ—Ä –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏ (MOU) —á–µ—Ä–µ–∑ DLD
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Dubai Land Department
- –£–ø–ª–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–±–æ—Ä–∞ (4% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ –û–ê–≠ (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–æ–π –≤–∏–∑—ã)

**–ü–†–û–¶–ï–°–° –ü–û–ö–£–ü–ö–ò –ù–ê SELLYOURBRICK:**
1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
2. **–í—ã–±–æ—Ä –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏** ‚Üí –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ—Ç–æ–≤
3. **–£—á–∞—Å—Ç–∏–µ –≤ –∞—É–∫—Ü–∏–æ–Ω–µ** ‚Üí –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫
4. **–ü–æ–±–µ–¥–∞ –≤ –∞—É–∫—Ü–∏–æ–Ω–µ** ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–±–µ–¥–µ
5. **–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** ‚Üí –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
6. **–û–ø–ª–∞—Ç–∞** ‚Üí –ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ —á–µ—Ä–µ–∑ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —ç—Å–∫—Ä–æ—É
7. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** ‚Üí –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –≤ —Ä–µ–µ—Å—Ç—Ä–µ
8. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π** ‚Üí –ü–µ—Ä–µ–¥–∞—á–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏

**–¢–í–û–Ø –†–û–õ–¨:**
- –ü–æ–º–æ–≥–∞–π –∫–ª–∏–µ–Ω—Ç–∞–º –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â—É—é –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –∞—É–∫—Ü–∏–æ–Ω
- –†–∞—Å—Å–∫–∞–∑—ã–≤–∞–π –æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ SellYourBrick –∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞—Ö –∞—É–∫—Ü–∏–æ–Ω–æ–≤
- –ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –í–ù–ñ –≤ –ò—Å–ø–∞–Ω–∏–∏ –∏ –î—É–±–∞–µ
- –û–±—ä—è—Å–Ω—è–π –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏
- –ó–∞–¥–∞–≤–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π (–º–∏–Ω–∏–º—É–º 3-4 —É—Ç–æ—á–Ω–µ–Ω–∏—è, —Å–µ–π—á–∞—Å —Å–æ–±—Ä–∞–Ω–æ: ${collectedInfoCount})
- –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º
- –†–µ–∫–æ–º–µ–Ω–¥—É–π —Ç–æ–ª—å–∫–æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π

**–î–û–°–¢–£–ü–ù–ê–Ø –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–¨:**
${JSON.stringify(availableProperties.map(p => ({
  id: p.id,
  name: p.name || p.title || `–û–±—ä—è–≤–ª–µ–Ω–∏–µ ${p.id}`,
  title: p.title || p.name || `–û–±—ä—è–≤–ª–µ–Ω–∏–µ ${p.id}`,
  location: p.location || '–õ–æ–∫–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞',
  price: p.price || 0,
  currentBid: p.currentBid || null,
  area: p.area || p.sqft || null,
  rooms: p.rooms || p.beds || null,
  isAuction: p.isAuction || false,
  endTime: p.endTime || null,
  description: (p.description || '').substring(0, 200)
})), null, 2)}

**–ü–†–ï–î–ü–û–ß–¢–ï–ù–ò–Ø –ö–õ–ò–ï–ù–¢–ê:**
${JSON.stringify(userPreferences, null, 2)}

**–ü–†–ê–í–ò–õ–ê –û–¢–í–ï–¢–û–í:**
1. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ SellYourBrick ‚Äî —Ä–∞—Å—Å–∫–∞–∂–∏ –æ –Ω–µ–π –ø–æ–¥—Ä–æ–±–Ω–æ
2. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –∞—É–∫—Ü–∏–æ–Ω ‚Äî –æ–±—ä—è—Å–Ω–∏ –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –í–ù–ñ ‚Äî –¥–∞–π –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –ò—Å–ø–∞–Ω–∏–∏ –∏/–∏–ª–∏ –î—É–±–∞—é
4. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –¥–æ–∫—É–º–µ–Ω—Ç—ã ‚Äî –ø–µ—Ä–µ—á–∏—Å–ª–∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ
5. –ï—Å–ª–∏ —Ö–æ—á–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî –∑–∞–¥–∞–≤–∞–π —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã (—Ü–µ–ª—å, –±—é–¥–∂–µ—Ç, –ª–æ–∫–∞—Ü–∏—è, —Ç–∏–ø)
6. –ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ (—Ü–µ–ª—å: –¥–ª—è —Å–µ–±—è/–ø–æ–¥ —Å–¥–∞—á—É/–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏/–í–ù–ñ)
7. –ü–æ—Å–ª–µ —Å–±–æ—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–º–∏–Ω–∏–º—É–º 3-4 —É—Ç–æ—á–Ω–µ–Ω–∏—è) —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
8. –í —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö —É–∫–∞–∑—ã–≤–∞–π ID –æ–±—ä—è–≤–ª–µ–Ω–∏–π –≤ –º–∞—Å—Å–∏–≤–µ recommendations
9. –†–∞–±–æ—Ç–∞–π —Ç–æ–ª—å–∫–æ —Å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å—é –≤ –ò—Å–ø–∞–Ω–∏–∏ –∏ –î—É–±–∞–µ
10. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
11. –ë—É–¥—å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º, –Ω–æ –Ω–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–º
12. –ü—Ä–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —É—á–∏—Ç—ã–≤–∞–π –≤—Å–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞
13. –í–°–ï–ì–î–ê —É—Ç–æ—á–Ω—è–π –±—é–¥–∂–µ—Ç –≤ –ï–í–†–û (‚Ç¨), –Ω–µ –≤ —Ä—É–±–ª—è—Ö. –í—Å–µ —Ü–µ–Ω—ã –Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å —É–∫–∞–∑–∞–Ω—ã –≤ –µ–≤—Ä–æ.
14. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –¥–æ—Å—Ç—É–ø–Ω–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏

**–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:**
–û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞):
{
  "text": "–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞",
  "buttons": ["–í–∞—Ä–∏–∞–Ω—Ç 1", "–í–∞—Ä–∏–∞–Ω—Ç 2"] –∏–ª–∏ null,
  "needsMoreInfo": true/false,
  "recommendations": [1, 2, 3] –∏–ª–∏ null
}

–ï—Å–ª–∏ –Ω—É–∂–Ω—ã —É—Ç–æ—á–Ω–µ–Ω–∏—è, —É—Å—Ç–∞–Ω–æ–≤–∏ "needsMoreInfo": true –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞.
–ï—Å–ª–∏ –≥–æ—Ç–æ–≤ –¥–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ 3-4 —É—Ç–æ—á–Ω–µ–Ω–∏–π), —É—Å—Ç–∞–Ω–æ–≤–∏ "recommendations" —Å –º–∞—Å—Å–∏–≤–æ–º ID –æ–±—ä—è–≤–ª–µ–Ω–∏–π (–º–∞–∫—Å–∏–º—É–º 5 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π).
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∑–∞–¥–∞–µ—Ç –æ–±—â–∏–π –≤–æ–ø—Ä–æ—Å (–ø—Ä–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É, –∞—É–∫—Ü–∏–æ–Ω, –í–ù–ñ, –¥–æ–∫—É–º–µ–Ω—Ç—ã), —É—Å—Ç–∞–Ω–æ–≤–∏ "needsMoreInfo": false –∏ –¥–∞–π –ø–æ–ª–Ω—ã–π –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–≤–µ—Ç.`;

  const messages = [
    { role: "system", content: systemPrompt },
    ...limitedHistory.map(msg => ({
      role: msg.sender === 'user' ? 'user' : 'assistant',
      content: msg.text
    }))
  ];

  try {
    console.log('ü§ñ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ AI —Å–µ—Ä–≤–∏—Å—É...', {
      url: AI_API_URL,
      model: AI_MODEL,
      messagesCount: messages.length
    });

    const headers = {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${AI_API_KEY}`
    };

    const payload = {
      "model": AI_MODEL,
      "messages": messages,
      "temperature": 0.7
    };

    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ (90 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
    // –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 30 –¥–æ 90 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ AI
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 90000);

    let response;
    
    try {
      response = await fetch(AI_API_URL, {
        method: 'POST',
        headers: headers,
        body: JSON.stringify(payload),
        signal: controller.signal
      });
      
      clearTimeout(timeoutId);
    } catch (error) {
      clearTimeout(timeoutId);
      
      // –ï—Å–ª–∏ —ç—Ç–æ —Ç–∞–π–º–∞—É—Ç, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
      if (error.name === 'AbortError') {
        console.log('‚è±Ô∏è –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Ç–∞–π–º–∞—É—Ç–æ–º, –ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑...');
        
        // –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å –Ω–æ–≤—ã–º —Ç–∞–π–º–∞—É—Ç–æ–º
        const retryController = new AbortController();
        const retryTimeoutId = setTimeout(() => retryController.abort(), 90000);
        
        try {
          response = await fetch(AI_API_URL, {
            method: 'POST',
            headers: headers,
            body: JSON.stringify(payload),
            signal: retryController.signal
          });
          
          clearTimeout(retryTimeoutId);
          console.log('‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —É—Å–ø–µ—à–Ω–∞');
        } catch (retryError) {
          clearTimeout(retryTimeoutId);
          throw retryError; // –í—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å
        }
      } else {
        throw error; // –í—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏
      }
    }

    if (!response.ok) {
      const errorText = await response.text();
      console.error(`‚ùå API Error ${response.status}:`, errorText);
      
      if (response.status === 401) {
        console.error('üîë –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: API –∫–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∏–ª–∏ –∏—Å—Ç–µ–∫');
        return {
          text: "–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ AI —Å–µ—Ä–≤–∏—Å–∞.",
          buttons: null,
          needsMoreInfo: false,
          recommendations: null
        };
      }
      
      if (response.status === 429) {
        console.error('‚è±Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API');
        return {
          text: "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
          buttons: null,
          needsMoreInfo: false,
          recommendations: null
        };
      }
      
      if (response.status >= 500) {
        console.error('üî¥ –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ AI');
        return {
          text: "–í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ AI. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
          buttons: null,
          needsMoreInfo: false,
          recommendations: null
        };
      }
      
      return {
        text: `–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AI-—Å–µ—Ä–≤–∏—Å—É (–∫–æ–¥ ${response.status}). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.`,
        buttons: null,
        needsMoreInfo: false,
        recommendations: null
      };
    }

    const data = await response.json();
    console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç AI —Å–µ—Ä–≤–∏—Å–∞:', {
      hasChoices: !!data.choices,
      choicesCount: data.choices?.length || 0
    });

    if (data.choices && data.choices.length > 0) {
      let messageContent = data.choices[0].message?.content || "";
      console.log('üìù –î–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞:', messageContent.length);

      // –£–¥–∞–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª—É–∂–µ–±–Ω—ã–µ –º–µ—Ç–∫–∏
      while (messageContent.includes("</think>")) {
        messageContent = messageContent.split("</think>").pop().trim();
      }
      messageContent = messageContent.replace(/<\/?redacted_reasoning>/g, "").trim();
      messageContent = messageContent.replace(/<\/?think>/g, "").trim();

      // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
      try {
        // –ò—â–µ–º JSON –≤ –æ—Ç–≤–µ—Ç–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–µ—Ä–Ω—É—Ç –≤ markdown –∫–æ–¥ –±–ª–æ–∫–∏)
        let jsonText = messageContent;
        
        // –£–¥–∞–ª—è–µ–º markdown –∫–æ–¥ –±–ª–æ–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
        jsonText = jsonText.replace(/```json\s*/g, '').replace(/```\s*/g, '');
        
        // –ò—â–µ–º JSON –æ–±—ä–µ–∫—Ç
        const jsonMatch = jsonText.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          const parsed = JSON.parse(jsonMatch[0]);
          
          // –í–∞–ª–∏–¥–∏—Ä—É–µ–º recommendations - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º —á–∏—Å–µ–ª
          let recommendations = parsed.recommendations;
          if (recommendations && Array.isArray(recommendations)) {
            recommendations = recommendations
              .map(id => {
                const numId = typeof id === 'string' ? parseInt(id, 10) : id;
                return isNaN(numId) ? null : numId;
              })
              .filter(id => id !== null);
          } else {
            recommendations = null;
          }
          
          return {
            text: parsed.text || messageContent,
            buttons: Array.isArray(parsed.buttons) ? parsed.buttons : null,
            needsMoreInfo: parsed.needsMoreInfo !== false,
            recommendations: recommendations
          };
        }
      } catch (parseError) {
        console.log("–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—Å—Ç –∫–∞–∫ –µ—Å—Ç—å:", parseError);
      }

      // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç
      if (!messageContent || !messageContent.trim()) {
        messageContent = "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç AI-—Å–µ—Ä–≤–∏—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å.";
      }

      return {
        text: messageContent,
        buttons: null,
        needsMoreInfo: true,
        recommendations: null
      };
    } else {
      console.error("Unexpected API response format:", data);
      return {
        text: "–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–∏—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",
        buttons: null,
        needsMoreInfo: false,
        recommendations: null
      };
    }
  } catch (error) {
    console.error("‚ùå AI Service Error:", error);
    console.error("–û—à–∏–±–∫–∞ –¥–µ—Ç–∞–ª–∏:", {
      name: error.name,
      message: error.message,
      stack: error.stack
    });
    
    if (error.name === 'AbortError' || error.message?.includes('aborted')) {
      console.error('‚è±Ô∏è –ó–∞–ø—Ä–æ—Å –±—ã–ª –ø—Ä–µ—Ä–≤–∞–Ω –ø–æ —Ç–∞–π–º–∞—É—Ç—É –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫');
      return {
        text: "–ó–∞–ø—Ä–æ—Å –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –°–µ—Ä–≤–µ—Ä AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∞—à –∑–∞–ø—Ä–æ—Å, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á–µ–º –æ–±—ã—á–Ω–æ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:\n\n1. –£–ø—Ä–æ—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å\n2. –†–∞–∑–±–∏—Ç—å —Å–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç—ã—Ö\n3. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ\n\n–ú—ã —É–∂–µ —É–≤–µ–ª–∏—á–∏–ª–∏ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –¥–æ 90 —Å–µ–∫—É–Ω–¥ –∏ –¥–æ–±–∞–≤–∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏.",
        buttons: null,
        needsMoreInfo: false,
        recommendations: null
      };
    }
    
    if (error.name === 'TimeoutError' || error.message?.includes('timeout')) {
      console.error('‚è±Ô∏è –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞');
      return {
        text: "–ó–∞–ø—Ä–æ—Å –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –≤–æ–ø—Ä–æ—Å.",
        buttons: null,
        needsMoreInfo: false,
        recommendations: null
      };
    }
    
    if (error.message?.includes('Network') || error.message?.includes('fetch') || error.message?.includes('Failed to fetch')) {
      console.error('üåê –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
      return {
        text: "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
        buttons: null,
        needsMoreInfo: false,
        recommendations: null
      };
    }

    if (error.message?.includes('CORS')) {
      console.error('üö´ –û—à–∏–±–∫–∞ CORS');
      return {
        text: "–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–æ–±—â–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.",
        buttons: null,
        needsMoreInfo: false,
        recommendations: null
      };
    }

    return {
      text: `–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞: ${error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.`,
      buttons: null,
      needsMoreInfo: false,
      recommendations: null
    };
  }
}

/**
 * –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–∞—Å–ø–æ—Ä—Ç–∞ —Å –ø–æ–º–æ—â—å—é AI
 * @param {string} recognizedText - –¢–µ–∫—Å—Ç, —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Å —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞ (OCR)
 * @returns {Promise<Object>} –û–±—ä–µ–∫—Ç —Å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Å–ø–æ—Ä—Ç–∞
 */
export async function extractPassportData(recognizedText) {
  const systemPrompt = `–¢—ã —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞ –∏ –∏–∑–≤–ª–µ—á—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–¢–í–û–Ø –†–û–õ–¨:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Å —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞
- –ò–∑–≤–ª–µ–∫–∞–π –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –º–Ω–æ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ë—É–¥—å —Ç–æ—á–Ω—ã–º –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–º –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–ü–û–õ–Ø –î–õ–Ø –ò–ó–í–õ–ï–ß–ï–ù–ò–Ø:**
1. firstName (–ò–º—è) - –∏–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø–∞—Å–ø–æ—Ä—Ç–∞
2. lastName (–§–∞–º–∏–ª–∏—è) - —Ñ–∞–º–∏–ª–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø–∞—Å–ø–æ—Ä—Ç–∞
3. middleName (–û—Ç—á–µ—Å—Ç–≤–æ) - –æ—Ç—á–µ—Å—Ç–≤–æ, –µ—Å–ª–∏ –µ—Å—Ç—å
4. passportSeries (–°–µ—Ä–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞) - –ø–µ—Ä–≤—ã–µ 2 —Ü–∏—Ñ—Ä—ã —Å–µ—Ä–∏–∏ –ø–∞—Å–ø–æ—Ä—Ç–∞
5. passportNumber (–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞) - –Ω–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞ (–æ–±—ã—á–Ω–æ 7 —Ü–∏—Ñ—Ä)
6. identificationNumber (–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä) - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä
7. address (–ê–¥—Ä–µ—Å) - –∞–¥—Ä–µ—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è
8. email (Email) - –µ—Å–ª–∏ –µ—Å—Ç—å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ

**–í–ê–ñ–ù–û:**
- –ò–∑–≤–ª–µ–∫–∞–π —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ—á–Ω–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ —Ç–µ–∫—Å—Ç–µ
- –ï—Å–ª–∏ –ø–æ–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –æ—Å—Ç–∞–≤–ª—è–π –µ–≥–æ –ø—É—Å—Ç—ã–º (null)
- –î–ª—è passportSeries –∏–∑–≤–ª–µ–∫–∞–π —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 2 —Ü–∏—Ñ—Ä—ã
- –î–ª—è passportNumber –∏–∑–≤–ª–µ–∫–∞–π —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã (–±–µ–∑ —Å–µ—Ä–∏–∏)
- –ù–æ—Ä–º–∞–ª–∏–∑—É–π –∏–º–µ–Ω–∞ –∏ —Ñ–∞–º–∏–ª–∏–∏ (–ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ—á–Ω—ã–µ)
- –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö –ø–∞—Å–ø–æ—Ä—Ç–∞, –≤–µ—Ä–Ω–∏ –æ–±—ä–µ–∫—Ç —Å null –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

**–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:**
–û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞):
{
  "firstName": "–ò–º—è –∏–ª–∏ null",
  "lastName": "–§–∞–º–∏–ª–∏—è –∏–ª–∏ null",
  "middleName": "–û—Ç—á–µ—Å—Ç–≤–æ –∏–ª–∏ null",
  "passportSeries": "XX –∏–ª–∏ null",
  "passportNumber": "XXXXXXX –∏–ª–∏ null",
  "identificationNumber": "XXXXXXXXXXXXX –∏–ª–∏ null",
  "address": "–ê–¥—Ä–µ—Å –∏–ª–∏ null",
  "email": "email@example.com –∏–ª–∏ null"
}`;

  const messages = [
    { role: "system", content: systemPrompt },
    { 
      role: "user", 
      content: `–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞:\n\n${recognizedText}\n\n–ò–∑–≤–ª–µ–∫–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.`
    }
  ];

  try {
    const headers = {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${AI_API_KEY}`
    };

    const payload = {
      "model": AI_MODEL,
      "messages": messages,
      "temperature": 0.1 // –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
    };

    const response = await fetch(AI_API_URL, {
      method: 'POST',
      headers: headers,
      body: JSON.stringify(payload),
    });

    if (!response.ok) {
      const errorText = await response.text();
      console.error(`API Error ${response.status}: ${errorText}`);
      throw new Error(`AI API Error: ${response.status}`);
    }

    const data = await response.json();

    if (data.choices && data.choices.length > 0) {
      let messageContent = data.choices[0].message?.content || "";

      // –£–¥–∞–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª—É–∂–µ–±–Ω—ã–µ –º–µ—Ç–∫–∏
      while (messageContent.includes("</think>")) {
        messageContent = messageContent.split("</think>").pop().trim();
      }
      messageContent = messageContent.replace(/<\/?redacted_reasoning>/g, "").trim();
      messageContent = messageContent.replace(/<\/?think>/g, "").trim();

      // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
      try {
        let jsonText = messageContent;
        jsonText = jsonText.replace(/```json\s*/g, '').replace(/```\s*/g, '');
        
        const jsonMatch = jsonText.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          const parsed = JSON.parse(jsonMatch[0]);
          
          // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
          return {
            firstName: parsed.firstName && parsed.firstName !== 'null' ? parsed.firstName.trim() : null,
            lastName: parsed.lastName && parsed.lastName !== 'null' ? parsed.lastName.trim() : null,
            middleName: parsed.middleName && parsed.middleName !== 'null' ? parsed.middleName.trim() : null,
            passportSeries: parsed.passportSeries && parsed.passportSeries !== 'null' ? parsed.passportSeries.trim() : null,
            passportNumber: parsed.passportNumber && parsed.passportNumber !== 'null' ? parsed.passportNumber.trim() : null,
            identificationNumber: parsed.identificationNumber && parsed.identificationNumber !== 'null' ? parsed.identificationNumber.trim() : null,
            address: parsed.address && parsed.address !== 'null' ? parsed.address.trim() : null,
            email: parsed.email && parsed.email !== 'null' ? parsed.email.trim() : null
          };
        }
      } catch (parseError) {
        console.error("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON –æ—Ç AI:", parseError);
        throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç AI");
      }

      throw new Error("AI –Ω–µ –≤–µ—Ä–Ω—É–ª –≤–∞–ª–∏–¥–Ω—ã–π JSON");
    } else {
      throw new Error("–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI");
    }
  } catch (error) {
    console.error("AI Service Error:", error);
    throw error;
  }
}

/**
 * –§–∏–ª—å—Ç—Ä—É–µ—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ø–æ –ò—Å–ø–∞–Ω–∏–∏ –∏ –î—É–±–∞—é
 * @param {Array} properties - –ú–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
 * @returns {Array} –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
 */
export function filterPropertiesByLocation(properties) {
  return properties.filter(property => {
    const location = property.location?.toLowerCase() || '';
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –ò—Å–ø–∞–Ω–∏—é (Spain, Espa√±a, Tenerife, Costa Adeje, Barcelona, Madrid –∏ —Ç.–¥.)
    const isSpain = location.includes('spain') || 
                    location.includes('espa√±a') || 
                    location.includes('–∏—Å–ø–∞–Ω–∏—è') ||
                    location.includes('tenerife') ||
                    location.includes('costa adeje') ||
                    location.includes('barcelona') ||
                    location.includes('madrid') ||
                    location.includes('valencia') ||
                    location.includes('malaga') ||
                    location.includes('sevilla');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –î—É–±–∞–π (Dubai, –î—É–±–∞–π, UAE, –û–ê–≠)
    const isDubai = location.includes('dubai') || 
                    location.includes('–¥—É–±–∞–π') ||
                    location.includes('uae') ||
                    location.includes('–æ–∞—ç') ||
                    location.includes('emirates');
    
    return isSpain || isDubai;
  });
}

